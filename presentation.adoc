= 😍 Tester en Kotlin 
:source-highlighter: highlightjs
:revealjs_theme: white
:revealjs_history: true
:data-uri:
:icons: font

== ⏱Kotlin, en quelque dates

* 2010 💡 JetBrains
* 2012 🤝 Open Source
* 2016 🚀 Kotlin `1.0`
* 2017 📱 Google I/O
* 2019 🤩 Kotlin `1.3.50`

== 🤓Kotlin en quelques mots

[quote]
Langage statiquement *typé*, orienté *object* et *fonctionnel*, centré sur la *productivité* du développeur

== Kotlin en quelques lignes de code

[source]
----
fun main() {
    println("Hello World!")
}
----

== Forces du langage

* 💪_Null Safety_ 
** `null` fait partie du système de type
* 👍_Immutable first_ 
** variable et collection immutables par défaut
* 📖Concis et expressif
* 🤝Interopabilité avec `Java` et son éco-système
** Build, Librairies, Outils

== Kotlin en 2019

image:images/kotlin-2019-1.png[]

== Kotlin en 2019

image:images/kotlin-2019-2.png[]

== Kotlin en 2019

image:images/kotlin-2019-3.png[]

== val me = "Benoit Prioux"

Tech Lead 

image:images/lectra.png[]

* icon:twitter[] icon:github[] binout 
* 10 ans ☕️ -> Kotlin 😍
* ❤️ Asciidoctor (🐜)

== Pourquoi parler des tests ?

image::images/testerdouter.png[]

== 🎮 Un super terrain de jeu 

* 😇Pas du code de production
* 😜Plus de liberté dans le design
* 🧔Souvent un peu de code _barbant_ 
** préparation des jeux de données

== 💡Ma proposition 

[quote]
Apprendre Kotlin par les tests

[quote]
Introduire Kotlin dans votre projet par les tests

== Java + Kotlin

image::images/java-kotlin-compilation.png[]

== Projet mix Java/Kotlin

* Facile à configurer
* Pas de pré-requis
* Java <-> Kotlin

== Disclaimer

[quote]
Au cours de cette présentation, je vais aborder des concepts du langage Kotlin par des exemples issus de code de test

== Framework de test

* Un runner
* Une lib d'assertions
* Une lib de mock

== Runner

Kotlin Test vs Junit 

== Junit 5 FTW !

image::images/junit5.png[]

== JUnit 5

* Refonte totale de Junit 
* Cf Devoxx Tools In Action
* Extension 

== JUnit 4 pas pour Kotlin

* Exemple de code en Kotlin / Junit 4
* Comparaison avec Junit 5

== Tips Junit 5

* Junit et instanciation de classe
** Lifecyle.PER_CLASS
* Provider et Junit 5 (Companion et @JVMOverload)

== Assertions

* AssertK vs AssertJ (fork de fest-assert)
* AssertJ c'est bien : pourquoi changer ?

== AssertJ et Kotlin

* Pas de problème, on reste sur la forme

[source, kotlin]
----
assertThat(...).isEqualTo()
----

== Tip AssertJ

* dataclass

[source, kotlin]
----
with(..) {
    assertThat()
}
----

* Awaitility untilAsserted


== Mockito ?

* Problème avec les classes finales
* when mot clé réservé

== Alternative Mockkk

* Cf Devoxx
* Syntax DSL élégante avec toutes les fonctions de mockito

[source, kotlin]
----
every { } returns ...
----

== Tips Mockk

* Mockk matcher
* ClearMockks

== Misc Tips

* Helper methods with default argument
* DSL pour construire les jeux de données
* Infix méthode 
* Méthodes d'extensions pour simplifier la construction de jeu de donnée

== Alors lundi vous commencez Kotlin ?

Pre-requis :
* Junit 5
* Intellij

1. Configurer maven/gradle
2. src/test/kotlin
3. add mockk as dependency


== C'est pas suffisant, Retour d'expérience

2 ans : code base de 60 000 LOC en java (7 microservices)

Aujourd'hui : 5 microservices en full kotlin

Dans quelques mois : codebase totalement en kotlin

== Chiffre

En moyenne 20% de LOC en moins (sans perte d'information)

Exemple : 
* stream().map().collect() -> map()
* dataclass

== ça change quoi ?

LOVE

Difficile de revenir en arrière

== Pour aller plus loin

* Blog Lectra
* Article Kotlin
* Article Java
