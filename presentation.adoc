= üòç Tester en Kotlin 
:source-highlighter: highlightjs
:revealjs_theme: white
:revealjs_history: true

== Kotlin

* Historique du langage
* Concept cl√©
* Positionnement par rapport Java

== Force du langage

* Null Safety
* Immutable first
* Productivit√© centric
* Object et Fonctionnel
* Orient√© DSL

== Kotlin et moi ?

* D√©veloppeur Java depuis 10 ans
* Maintenant Kotlin -> langage de base

== Pourquoi parler des tests ?

* On commence toujours par les tests ;-)

== Projet mix Java/Kotlin

* Facile √† configurer
* Pas de pr√©-requis
* Java <-> Kotlin

== Les tests : un super terrain de jeu

* Pas du code de production
* Plus de libert√© dans le design (en particulier dans du code legacy)
* Super important d'avoir un bon environnement de test
* Bac √† sable pour apprendre Kotlin

== Disclaimer

[quote]
Au cours de cette pr√©sentation, je vais aborder des concepts du langage Kotlin par des exemples issus de code de test

== Framework de test

* Un runner
* Une lib d'assertions
* Une lib de mock

== Runner

Kotlin Test vs Junit 

== Junit 5 FTW !

* Refonte totale de Junit 
* Cf Devoxx Tools In Action
* Extension 

== JUnit 4 pas pour Kotlin

* Exemple de code en Kotlin / Junit 4
* Comparaison avec Junit 5

== Tips Junit 5

* Junit et instanciation de classe
** Lifecyle.PER_CLASS
* Provider et Junit 5 (Companion et @JVMOverload)
* Helper methods with default argument

== Assertions

* AssertK vs AssertJ (fork de fest-assert)
* AssertJ c'est bien : pourquoi changer ?

== AssertJ et Kotlin

* Pas de probl√®me, on reste sur la forme

[source, kotlin]
----
assertThat(...).isEqualTo()
----

== Tip AssertJ

* dataclass

[source, kotlin]
----
with(..) {
    assertThat()
}
----

* Awaitility untilAsserted


== Mockito ?

* Probl√®me avec les classes finales
* when mot cl√© r√©serv√©

== Alternative Mockkk

* Cf Devoxx
* Syntax DSL √©l√©gante avec toutes les fonctions de mockito

[source, kotlin]
----
every { } returns ...
----

== Tips Mockk

* Mockk matcher
* ClearMockks

== Alors lundi vous commencez Kotlin ?

Pre-requis :
* Junit 5
* Intellij

1. Configurer maven/gradle
2. src/test/kotlin
3. add mockk as dependency


== C'est pas suffisant, Retour d'exp√©rience

2 ans : code base de 60 000 LOC en java (7 microservices)

Aujourd'hui : 5 microservices en full kotlin

Dans quelques mois : codebase totalement en kotlin

== Chiffre

En moyenne 20% de LOC en moins (sans perte d'information)

Exemple : 
* stream().map().collect() -> map()
* dataclass

== √ßa change quoi ?

LOVE

Difficile de revenir en arri√®re

== Pour aller plus loin

* Blog Lectra
* Article Kotlin
* Article Java
