= ğŸ˜ Tester en Kotlin 
:source-highlighter: highlightjs
:revealjs_theme: white
:revealjs_history: true
:data-uri:
:icons: font

== Kotlin

=== â±Kotlin, en quelque dates

* 2010 ğŸ’¡ JetBrains
* 2012 ğŸ¤ Open Source
* 2016 ğŸš€ Kotlin `1.0`
* 2017 ğŸ“± Google I/O
* 2019 ğŸ¤© Kotlin `1.3.50`

=== ğŸ¤“Kotlin en quelques mots

[quote]
Langage statiquement *typÃ©*, orientÃ© *object* et *fonctionnel*, centrÃ© sur la *productivitÃ©* du dÃ©veloppeur

=== Kotlin en quelques lignes de code

[source]
----
fun main() {
    println("Hello World!")
}
----

=== Forces du langage

* ğŸ’ª_Null Safety_ 
** `null` fait partie du systÃ¨me de type
* ğŸ‘_Immutable first_ 
** variable et collection immutables par dÃ©faut
* ğŸ“–Concis et expressif
* ğŸ¤InteropabilitÃ© avec `Java` et son Ã©co-systÃ¨me
** Build, Librairies, Outils

=== Kotlin en 2019

image:images/kotlin-2019-1.png[]

=== Kotlin en 2019

image:images/kotlin-2019-2.png[]

=== Kotlin en 2019

image:images/kotlin-2019-3.png[]

== val me = "Benoit Prioux"

Tech Lead 

image:images/lectra.png[]

* icon:twitter[] icon:github[] binout 
* 10 ans â˜•ï¸ -> Kotlin ğŸ˜
* â¤ï¸ Asciidoctor (ğŸœ)

== Pourquoi parler des tests ?

image::images/testerdouter.png[]

== ğŸ® Un super terrain de jeu 

* ğŸ˜‡Pas du code de production
* ğŸ˜œPlus de libertÃ© dans le design
* ğŸ§”Souvent un peu de code _barbant_ 
** prÃ©paration des jeux de donnÃ©es

== ğŸ’¡Ma proposition 

[quote]
Apprendre Kotlin par les tests

[quote]
Introduire Kotlin dans votre projet par les tests

=== Java + Kotlin

image::images/java-kotlin-compilation.png[]

=== Projet mix Java/Kotlin

. CrÃ©er : `src/test/kotlin`
. Configurer build : plugin `Maven`/`Gradle`
. Ajouter :
[source]
----
    <dependency>
        <groupId>org.jetbrains.kotlin</groupId>
        <artifactId>kotlin-stdlib</artifactId>
        <version>${kotlin.version}</version>
    </dependency>
----

=== Java ğŸ¤ Kotlin

image:images/kotlin-java.png[]

== Disclaimer

[quote]
Au cours de cette prÃ©sentation, je vais aborder des concepts du langage Kotlin par des exemples issus de code de test

== ğŸ­Framework de test

* Un runner 
* Une librairie d'assertions
* Une librairie de mock

=== kotlin.test

TODO()

=== KotlinTest

TODO()

=== Example 

[source]
----
class MyTests : StringSpec({
  "length should return size of string" {
    "hello".length shouldBe 5
  }
  "startsWith should test for a prefix" {
    "world" should startWith("wor")
  }
})
----

== Mon avis 

* Apprendre un nouveau framework de test en plus d'apprendre un nouveau langage ğŸ¤¯

[quote]
Junit FTW !


=== JUnit 4 pas pour Kotlin

* Exemple de code en Kotlin / Junit 4
* Comparaison avec Junit 5

=== Junit 4 & Java

[source]
----
public class RepoTestJUnit4 {

    private static Database db;
    private static Repository repo;

    @BeforeClass
    public void initialize() {
        db = new TestDatabase()
        db.start()
        repo = new Repository(db)
    }

    @Test
    public void foo() {
        // test repo
    }
}
----

=== Junit 4 & Kotlin

[source]
----
class RepoTestJUnit4 {

    companion object {
        @JvmStatic
        private lateinit var db: Database
        @JvmStatic
        private lateinit var repo: Repository

        @BeforeClass
        @JvmStatic
        fun initialize() {
            db = TestDatabase()
            db.start()
            repo = Repository(db.host, db.port)
        }
    }

    @Test
    fun foo() {
        // test repo
    }
}
----

=== Kotlin val/var

TODO()

=== Kotlin : no static

TODO()

==== Kotlin idiomatic

TODO()

== JUnit 5

image::images/junit5.png[]

* Refonte totale de Junit 
* Cf Devoxx Tools In Action
* Extension 

=== Tips Junit 5

* Junit et instanciation de classe
** Lifecyle.PER_CLASS
* Provider et Junit 5 (Companion et @JVMOverload)

== Assertions

* AssertK vs AssertJ (fork de fest-assert)
* AssertJ c'est bien : pourquoi changer ?

=== AssertJ et Kotlin

* Pas de problÃ¨me, on reste sur la forme

[source, kotlin]
----
assertThat(...).isEqualTo()
----

=== Tip AssertJ

* dataclass

[source, kotlin]
----
with(..) {
    assertThat()
}
----

* Awaitility untilAsserted


== Mockito ?

* ProblÃ¨me avec les classes finales
* when mot clÃ© rÃ©servÃ©

=== Alternative Mockkk

* Cf Devoxx
* Syntax DSL Ã©lÃ©gante avec toutes les fonctions de mockito

[source, kotlin]
----
every { } returns ...
----

=== Tips Mockk

* Mockk matcher
* ClearMockks

== Misc Tips

* Helper methods with default argument
* DSL pour construire les jeux de donnÃ©es
* Infix mÃ©thode 
* MÃ©thodes d'extensions pour simplifier la construction de jeu de donnÃ©e

== Alors lundi vous commencez Kotlin ?

Pre-requis :
* Junit 5
* Intellij

1. Configurer maven/gradle
2. src/test/kotlin
3. add mockk as dependency


== C'est pas suffisant, Retour d'expÃ©rience

2 ans : code base de 60 000 LOC en java (7 microservices)

Aujourd'hui : 5 microservices en full kotlin

Dans quelques mois : codebase totalement en kotlin

== Chiffre

En moyenne 20% de LOC en moins (sans perte d'information)

Exemple : 
* stream().map().collect() -> map()
* dataclass

== Ã§a change quoi ?

LOVE

Difficile de revenir en arriÃ¨re

== Pour aller plus loin

* Blog Lectra
* Article Kotlin
* Article Java
